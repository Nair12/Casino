@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
body {
    background-image: url('/images/playBg.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    color: #fff;
}

/* ALERTS */
.alert {
    border-radius: 12px;
    padding: 15px 20px;
    margin-bottom: 20px;
    font-weight: 600;
}

/* TIMER */
.timer {
    font-size: 24px;
    font-weight: 700;
    margin-bottom: 20px;
    text-align: center;
    background: rgba(0,0,0,0.5);
    padding: 15px 0;
    border-radius: 12px;
    box-shadow: 0 6px 15px rgba(0,0,0,0.4);
}

/* ROULETTE LAYOUT */
.table {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
}

/* LEFT + RIGHT CARDS */
.left-roulete, .right-roulete {
    background: linear-gradient(145deg, rgba(30,30,30,0.9), rgba(60,60,60,0.8));
    border-radius: 20px;
    padding: 25px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.6);
}

.left-roulete{
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;

}



/* WIN NUMBER */
.win {
    font-size: 64px;
    font-weight: 800;
    text-align: center;
    padding: 25px 0;
    border-radius: 16px;
    margin-bottom: 25px;
    color: #fff;
    text-shadow: 1px 1px 4px rgba(0,0,0,0.6);
}

.win-red { background-color: #d32f2f; }
.win-black { background-color: #212121; }
.win-green { background-color: #388e3c; }

/* HISTORY */
.history {
    display: flex;
    gap: 6px;
    padding-bottom: 10px;
    width:100%;
    height:auto;
    align-content:space-between;
    justify-content:center;


}

.history::-webkit-scrollbar {
    height: 6px;
}

.history::-webkit-scrollbar-thumb {
    background: #ffb300;
    border-radius: 3px;
}

.history div {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    color: white;
    border: 2px solid #fff;
    flex-shrink: 0;
    transition: transform 0.2s;
}

.history div:hover {
    transform: scale(1.2);
}

/* BET FORM */
.bet-form {
    width: 100%;
    margin-bottom: 15px;
    padding: 12px;
    border-radius: 10px;
    border: none;
    font-size: 16px;
    background: rgba(255,255,255,0.1);
    color: #fff;
}

.bet-form:focus {
    outline: none;
    background: rgba(255,255,255,0.2);
}
.bet-form option {
    color:black;
    background-color:darkslateblue;

}



/* MAKE BET BUTTON */
.btn-warning {
    width: 100%;
    padding: 14px;
    font-size: 18px;
    font-weight: 700;
    border-radius: 12px;
    cursor: pointer;
    transition: 0.3s;
    border: none;
    background: #ffb300;
    color: #000;
    box-shadow: 0 5px 15px rgba(0,0,0,0.4);
}

.btn-warning:hover {
    background-color: #ffc107;
    transform: translateY(-2px);
}

/* BET LIST */
#bet-list table {
    width: 100%;
    margin-top: 20px;
    border-collapse: collapse;
}

#bet-list td {
    padding: 10px;
    border-bottom: 1px solid rgba(255,255,255,0.2);
    text-align: center;
    font-weight: 600;
    color: #ffeb3b;
}

/* Responsive */

}
</style>




<div class="row">
    @if (ViewBag.NickName != null)
    {
        <div class="alert alert-success">Welcome @ViewBag.NickName</div>
    }

    @if (ViewBag.msg != null)
    {
        <div class="alert alert-danger">@ViewBag.msg</div>
    }
</div>

<div class="row">
    <div id="timer" class="timer"></div>
    <div id="period" style="display:none;">@ViewBag.Period</div>
</div>

@if (!String.IsNullOrEmpty(ViewBag.NonActiveMsg))
{
    <div class="row">
        <div class="alert alert-warning">@ViewBag.NonActiveMsg</div>
    </div>
}

<div class="row table m-1 d-flex justify-content-center align-center p-4">

    <!-- LEFT: WIN NUMBER + HISTORY -->
    <div class="left-roulete col-md-6 col-lg-6 col-sm-12">
        <div class="win win-@ViewBag.WinColor">@ViewBag.WinNumber</div>
        <div class="history" id="history"></div>
    </div>

    <!-- RIGHT: BET FORM -->
    <div class="right-roulete col-md-6 col-lg-6 col-sm-12">
        <form asp-action="MakeBet" method="post">
            <input type="number" name="number" value="-1" min="-1" max="36" placeholder="Number" class="bet-form" />
            <select name="color" class="bet-form">
                <option value="">Color</option>
                <option value="red">Red</option>
                <option value="black">Black</option>
            </select>
            <select name="oddEven" class="bet-form">
                <option value="">Odd or Even...</option>
                <option value="even">Even</option>
                <option value="odd">Odd</option>
            </select>
            <input type="number" name="money" min="10" value="10" placeholder="Money to bet" class="bet-form" />
            <input type="button" value="Make Bet" class="btn btn-warning" onclick="makeBet(event)" />
        </form>
        <div id="bet-list"></div>
    </div>

</div>



<script>

    window.onload = function () {
        displayHistory();
    };

    let divTimer = document.getElementById("timer");
    let period = parseInt(document.getElementById("period").innerHTML);
    let elapsed = 0;

    setInterval(() => {
        divTimer.innerHTML = "Game starts in: " + (period - elapsed) + " seconds";
        elapsed++;
        if (elapsed > period) {
            elapsed = 0;
            location.reload();
        }
    }, 1000);

    function displayHistory() {
        const div = document.getElementById("history");
        if (!div) return;

        fetch("http://192.168.0.100:5138/Roulette/GetHistory")
            .then(res => res.json())
            .then(list => {
                div.innerHTML = "";
                list.forEach(item => {
                    const cell = document.createElement("div");
                    cell.textContent = item.number;
                    cell.style.backgroundColor = item.color;
                    div.appendChild(cell);
                });
            })
            .catch(console.error);
    }

    function makeBet(event) {
        const number = document.querySelector('input[name="number"]').value;
        const color = document.querySelector('select[name="color"]').value;
        const oddEven = document.querySelector('select[name="oddEven"]').value;
        const money = document.querySelector('input[name="money"]').value;

        fetch(`ProcessBet?number=${number}&color=${color}&oddEven=${oddEven}&money=${money}`)
            .then(res => res.json())
            .then(res => {
                const list = JSON.parse(res);
                const div = document.getElementById("bet-list");
                div.innerHTML = "";
                const t = document.createElement('table');
                t.className = "table table-striped";
                div.appendChild(t);

                list.forEach(item => {
                    const tr = document.createElement('tr');

                    const td1 = document.createElement('td'); td1.textContent = item.number;
                    const td2 = document.createElement('td'); td2.textContent = item.Money;
                    const td3 = document.createElement('td'); td3.textContent = new Date(item.CreatedAt).toLocaleString();
                    const td4 = document.createElement('td'); td4.textContent = "@ViewBag.NickName";

                    tr.append(td1, td2, td3, td4);
                    t.appendChild(tr);
                });
            })
            .catch(console.error);
    }





</script>